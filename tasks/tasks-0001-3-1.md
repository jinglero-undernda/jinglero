# Task 3.1: EntityCard Component Plan

## Overview

Create a reusable `EntityCard.tsx` React component for concise, card-style summary display of entities (Jingle, Fabrica, Cancion, Artista, Tematica). Component must be accessible, responsive, visually consistent, and all UI/user-facing text should be in Spanish (Argentina).

---

## 1. Purpose & Scope

- Reusable React component for entity-summary (Table style)
- Supported entity types: Jingle, Fabrica, Cancion, Artista, Tematica
- Used in lists, search results, and related-entities displays
- Visual and accessibility consistency across the platform

---

## 2. UX & Design Requirements

- **Primary fields:**
  - _Title_ (title, stageName; fallback to id if no other info)
  - _Secondary info_: author/song/date/category, depending on entity type
  - _Optionals_: thumbnail, icon, brief description, badges/tags
- **Actionable:** Card must be clickable/navigable (route to entity detail)
- **Visual:**
  - 8px border-radius, subtle shadow, highlighted background color for active/selected cards
  - Entity-type icon (SVG/emoji for MVP)
  - All UI (button, label, badge, etc.): Spanish (Argentina)
  - Responsive: adapts layout/typography for mobile and desktop
- **Fallbacks:**
  - If missing data, use “A CONFIRMAR”, “Anónimo” or other UX fallbacks per design/PRD

---

## 3. Types & Data Used

- Use frontend types from `/frontend/src/types/index.ts` for each entity
- Suggested prop shape:

```typescript
  type EntityCardProps = {
    entity: Artista | Cancion | Fabrica | Jingle | Tematica;
    entityType: 'artista' | 'cancion' | 'fabrica' | 'jingle' | 'tematica';
    to?: string; // Route destination
    active?: boolean; // Card highlighted/selected
    badge?: React.ReactNode; // Custom badge for status etc
    ...etc
  }
```

---

## 4. Behavior & Accessibility

- Card is keyboard/screen-reader accessible (role, aria-label as needed)
- Fully clickable/tappable for navigation
- Highlight on active and focus
- Responsive and visible focus/hover states

---

## 5. Implementation Steps

1. **Review Types**

   - [ ] Review all entity types in `/types/index.ts`
   - [ ] List main/secondary summary fields for each type

2. **Props & Interface Design**

   - [ ] Define flexible `EntityCardProps` interface (see above)
   - [ ] Conditional logic by `entityType`

3. **Component Construction**

   - [ ] Card container (div or Link, based on `to`)
   - [ ] Render icon/avatar, primary, secondary fields, tags/badges, thumbnail if available
   - [ ] UI labels and all user-facing content in Spanish (Argentina)

4. **Styling & Responsiveness**

   - [ ] Create/extend CSS: padding, border-radius 8px, shadow, adapt for mobile/desktop
   - [ ] Hover and selected styles

5. **Accessibility**

   - [ ] Appropriate role and aria-label for key sections
   - [ ] Clean tab order

6. **Testing & Documentation**

   - [ ] Test/demo page or Storybook: Example for each entity type
   - [ ] Edge cases: missing data, long text, active/selected
   - [ ] Basic unit tests (render, click, fallback checks)
   - [ ] Document usage with code example

7. **Integration**
   - [ ] Replace old summary/list UIs with `EntityCard`
   - [ ] Integrate in planned `RelatedEntities` component

---

## 6. Design & Visual Reference

- Reference styles: `JingleMetadata`, `JingleTimelineRow`, existing card/badge/button styles
- Use available entity-type SVGs or emoji per type
- Use design tokens/colors in `design-system.css`

## 7. Affected Files

- New: `/frontend/src/components/common/EntityCard.tsx`
- New or update: `/frontend/src/styles/components/entity-card.css` or `design-system.css`
- Uses: `/frontend/src/types/index.ts`, test routes/mocks/examples

## 8. Deliverables

- [ ] Fully responsive and accessible EntityCard component
- [ ] Unified, consistent styling with platform
- [ ] Example/demonstration of each entity type
- [ ] Basic usage docs in code or test/demo page

---

**Notes**

- Internal documentation and implementation steps are in English for developer clarity
- Only user-facing UI (labels, badges, buttons, tooltips, placeholders) must be in Spanish (Argentina)
- Prioritize clarity, data fallback, short UI text, accessibility, clean visual design
- MVP does not require real image/icon assets as long as placeholder or emoji is provided

---

## Appendix: Template for Cascading/Nested Entity Table Specification

> Fill out for each entity-type and expansion/nesting scenario.

### 1. All entity types

- **Row Composition:**
  - Container with two columns: left column with field label and right column with nested entities. If there are several entities, they appear as rows (appearance of a table with the cells on the left merged)
  - Each entity displays the primary field of the nested element, and an icon to expand/collapse if it is expandable and has nested entities.
  - If there are more than 5 nested entities, the list is collapsed into a single row showing the number of nested entities ("Mostrar # <entidades>)" and a button to expand is displayed. Note this option is only triggered with more than 5 entities. When expanded, present the list as part of the nested table.
  - For narrow views, the title is displayed above the nested entities and the left column keeps a small width (that will create an "indentation" effect on the list)
  - Text in all cells wraps on overspill and shows full text
  - If a field is empty, the row is not displayed
- **Maximum Suggested Depth (Nesting):**
  - Expand up to 5 levels of nesting.
- **Cycle Prevention Policy:**
  - Skip entities that are already in the path (a good example is the Fabrica -> Jingle -> Fabrica cycle). The parent-child should be obvious so not expecting to add a notice for omitted entities.
- **Data Loading (for Expanded Sub-rows):**
  - Retrieve the number of instances to trigger the rule of showing only the number of entities and a button to expand.
  - Load title and (if needed)sorting data to generate the list
  - Lazy load on expand of the cascading data.

#### Fabrica

- **Primary Fields to Display:**
  - Titulo
- **Secondary/Metadata Fields:**
  - Fecha de publicacion
- **Relationships (Expandable):**
  - Jingles (Expandable, sorted by timestamp)

#### Jingle

- **Primary Fields to Display:**
  - Titulo
- **Secondary/Metadata Fields:**
  - Fecha de publicacion (fabrica.date) or "INEDITO" if the Jingle is not linked to a Fabrica.
  - Es Jinglazo (isJinglazo) - desplay "JINGLAZO" if true, ignore if false
  - Es Precario (isPrecario) - desplay "PRECARIO" if true, ignore if false
- **Relationships (Expandable):**
  - Fabrica (Expandable)
  - Cancion (Expandable)
  - Autor (Expandable, sorted alphabetically by StageName)
  - Jinglero (Expandable, sorted alphabetically by StageName)
  - Tematicas (Expandable, sorted by Category then aplhabetically)

#### Cancion

- **Primary Fields to Display:**
  - "Titulo (Autor(es))"
- **Secondary/Metadata Fields:**
  - Titulo
  - Album
  - Año
  - Imagen (from YouTube URL if available)
- **Relationships (Expandable):**
  - Autor (Expandable - Artista, sorted alphabetically by StageName)
  - Jingles (Expandable, sorted by fabrica.date, tie break by timestamp)

#### Artista (Jinglero or Autor)

- **Primary Fields to Display:**
  - Nombre Artistico (stageName)
- **Secondary/Metadata Fields:**
  - Nombre Real (name)
  - Nacionalidad
- **Relationships (Expandable):**
  - Canciones (Expandable, sorted alphabetically by Title)
  - Jingles (Expandable, sorted by fabrica.date)

#### Tematica

- **Primary Fields to Display:**
  - Nombre (name)
- **Secondary/Metadata Fields:**
  - Categoria (category)
- **Relationships (Expandable):**
  - Jingles (Expandable, sorted by fabrica.date, tie break by timestamp)

### 2. UI/UX Considerations (for responsive/crowded views)

- **On Mobile:**
  - Follow rules for narrow views
- **On Desktop:**
  - No specific rules, looks like a table.
- **Visual/Interaction Rules:**
  - Icon to expand/collapse is displayed on the right side of the primary field.
  - Icon toggles between the collapsed and expanded state.
- **Overflow Handling:**
  - All fields word-wrap on overspill.

### 3. Performance/

- **Lazy Loading Strategy:**
  - Expand-by-click loads data only when needed
- **Memoization/Cache Policy:**
  - Store the information of expanded entities to avoid re-fetching data when the entity is expanded again.
- **Batch/Parallel Fetches:**
  - Sequential fetch is acceptable. Batch when allowed by API.

### 4. Special Cases

- **Circular Reference Example:**
  - Will feed back after initial implementation.
- **Edge Cases (Large Lists, Empty Relations, Permission-Restricted Items):**
  - Will feed back after initial implementation.

### 5. Example Path/Nesting Walkthrough

1- The main page presents an Artist.
2- The user can see the list of Canciones and Jingles they created (default Table).
3- The user can expand one Cancion to see its details, includingthe list of Jingles that use it.
4- The user can expand one Jingle to see the Fabrica it belongs to and the Jinglero that performed it. Note on circularity - this list will not include the Artist of step 1.
5- The user can expand one Jinglero to see the list of Jingles they performed. Note on circularity - this list will not include the Jingles that were listed in steps 2.
6- The user can expand a Jingle to see the Cancion it versions or the Fabrica it belongs to.

---
