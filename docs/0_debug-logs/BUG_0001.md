# BUG_0001 – Fabrica metadata editor hides empty configured fields

## Metadata

- **Status**: resolved
- **Last Updated**: 2025-11-17
- **Category**: frontend
- **Severity**: medium
- **Environment**: macOS 12.6, Chrome 118, Vite dev server (`npm run dev`), page `http://localhost:5173/admin/f/DLe3hojAro0`
- **Related Commits / PRs**: _(pending – reference commits as `BUG_0001: ...`)_

## Reproduction Steps

1. Run the frontend locally (`npm run dev`) and ensure the admin API is reachable.
2. Navigate to `/admin/f/DLe3hojAro0` (any Fabrica record with sparse metadata reproduces).
3. Observe the `Metadatos` section rendered by `EntityMetadataEditor`.
4. Note that only `id`, `title`, `date`, and `youtubeUrl` are shown; `status` and `contents` never appear unless the DB record already contains those properties.

## Description

The Fabrica metadata panel should always surface the fields listed in the refactor spec (Section 5.1, "Field Display Order"), even when a value is empty. Currently, admins cannot view or edit `status` or `contents` unless those properties already exist on the node, making it impossible to populate them from the UI for older Fabricas.

## Root Cause

`EntityMetadataEditor` intentionally pre-populates `formData` with every entry in `FIELD_ORDER.fabrica`, but the rendering path immediately filters fields back down to those that exist on the `entity` object:

- In the Fabrica branch of `editableFields`, the guard `if (!(key in entity)) return false;` removes any configured field whose value is absent on the fetched entity.
- Because legacy Fabricas omit `contents`, `status`, etc., those keys never render despite being present in configuration.

This logic diverges from the approved behavior (always show the configured field list regardless of current value).

## Resolution

- Updated the Fabrica and Cancion `editableFields` filters in `EntityMetadataEditor` to mirror the Jingle/Artista logic (use `formData` fallback instead of requiring the key to exist on the fetched entity).
- This guarantees that every configured field (including ones currently `undefined`) renders with an editable row, unlocking `status`, `contents`, etc. for sparse Fabricas.
- Verification 2025‑11‑17: user confirmed the Fabrica admin page now shows and edits the previously missing fields in both read-only and edit modes. A regression test is still recommended to guard against future filtering regressions.

## Related Files

- `frontend/src/components/admin/EntityMetadataEditor.tsx` → search `FIELD_ORDER.fabrica.filter((key)` to inspect the `key in entity` check.
- `frontend/src/lib/config/fieldConfigs.ts` → search `FIELD_ORDER: Record` to confirm Fabrica should show `contents`.
- `docs/adminRefactor/adminDetailedSpecification_R2.md` → search `Fabrica` + `Field Display Order` for the UX requirement.

## Related Code

- `frontend/src/components/admin/EntityMetadataEditor.tsx`
  - `if (entityType === 'fabrica' && FIELD_ORDER.fabrica) { ... const value = formData[key] ?? (entity as any)[key] ?? undefined; ... }`
